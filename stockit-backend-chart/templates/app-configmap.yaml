apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "stockit-backend-chart.fullname" . }}-app-configmap
  labels:
    {{- include "stockit-backend-chart.labels" . | nindent 4 }}
data:
  # 1. Spring Profile 설정 (values.yaml의 global.springProfile 참조)
  # Spring Deployment에서 env로 직접 설정하고 있으나, ConfigMap에 포함하여 중앙 관리 가능
  SPRING_PROFILES_ACTIVE: {{ .Values.global.springProfile | quote }}

  # 2. Database (PostgreSQL) 연결 설정
  # Spring Boot 애플리케이션이 사용할 DB 접속 정보
  # DB 비밀번호는 Secret에서 가져오므로, 여기서는 호스트, 포트, DB 이름만 설정합니다.
  # Host는 DB Headless Service 이름입니다.
  SPRING_DATASOURCE_URL: "jdbc:postgresql://{{ .Values.db.service.host }}:{{ .Values.db.service.port }}/{{ .Values.db.name }}"
  SPRING_DATASOURCE_USERNAME: {{ .Values.db.name | quote }}

  # 3. Redis 캐시 연결 설정
  # Redis 호스트 이름은 Redis Service의 이름입니다.
  SPRING_REDIS_HOST: {{ .Values.redis.service.host | quote }}
  SPRING_REDIS_PORT: {{ .Values.redis.service.port | quote }}

  # 4. AI Server 연결 설정
  # AI 서버는 Deployment와 Service를 통해 접근합니다.
  AI_SERVER_HOST: {{ include "stockit-backend-chart.fullname" . }}-{{ .Values.aiServer.name }}-service # AI Service의 렌더링된 이름
  AI_SERVER_PORT: {{ .Values.aiServer.service.port | quote }}
  
  # Python 분석 서버 URL (Spring Boot application.yml에서 사용)
  # 별도 배포된 stock-analyze-svc 서비스에 연결 (ClusterIP, 내부 통신용)
  PYTHON_ANALYSIS_URL: "http://stock-analyze-svc:8000"