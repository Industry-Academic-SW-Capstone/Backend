service:
  type: ClusterIP
  port: 8080

# --- 1. Global / Common Settings ---
global:
  name: stockit
  springProfile: dev

# --- 2. Backend (Spring Boot) Configuration ---
backend:
  name: spring-backend
  image:
    repository: choij17/stockit-backend
    tag: "0.1.6-amd64"
    pullPolicy: Always
  service:
    port: 8080
    targetPort: 8080
    type: ClusterIP
  probe:
    path: /actuator/health
    initialDelaySeconds: 120
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 5
  env:
    # NOTE:
    #   JWT_SECRET는 Helm 차트에 포함되지 않습니다.
    #   배포 전에 아래 명령으로 Kubernetes Secret을 직접 생성하세요.
    #     kubectl create secret generic stockit-secrets --from-literal=JWT_SECRET=<랜덤-값>
    #   Secret 이름은 templates/spring-deployment.yaml에서 참조하는 `stockit-secrets`와 동일해야 합니다.
    - name: SPRING_DATASOURCE_URL
      value: "jdbc:postgresql://postgres-db-service:5432/postgres-db"
    - name: SPRING_DATASOURCE_USERNAME
      value: "postgres-db"
    - name: SPRING_DATASOURCE_PASSWORD
      valueFrom:
        secretKeyRef:
          name: '{{ include "stockit-backend-chart.fullname" . }}-db-secret'
          key: POSTGRES_PASSWORD

# --- 3. AI Server (Python) Configuration ---
aiServer:
  enabled: false # stock-analyze-deployment가 별도로 배포되어 있으므로 비활성화
  name: python-ai-server
  image:
    repository: choij17/stock-ai-analyze-server
    tag: "0.1.4"
    pullPolicy: Always
  service:
    port: 8000
    targetPort: 8000
    type: ClusterIP
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/path: "/metrics"
    prometheus.io/port: "8000"
  command:
    - /usr/local/bin/uvicorn
    - app.main:app
    - --host
    - 0.0.0.0
    - --port
    - "8000"
  resources:
    limits:
      cpu: "1000m"
      memory: "2048Mi"
    requests:
      cpu: "500m"
      memory: "1024Mi"

# --- 4. Database (PostgreSQL) Configuration ---
db:
  name: postgres-db
  image: postgres
  tag: "15"
  service:
    port: 5432
    targetPort: 5432
    externalPort: 5432 # 외부 접속용 포트 (LoadBalancer Service)
    host: postgres-db-service
  persistence:
    enabled: true
    storageClass: ""
    size: 5Gi
  exporter:
    enabled: true
    image: prometheuscommunity/postgres-exporter
    tag: "v0.15.0"
    port: 9187
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi

# --- 5. Cache (Redis) Configuration ---
redis:
  name: stockit-redis
  image: docker.io/library/redis
  tag: "7-alpine"
  service:
    port: 6379
    targetPort: 6379
    host: redis-service
  persistence:
    enabled: true
    size: 1Gi

# --- 6. Service Account Configuration ---
serviceAccount:
  create: true
  name: ""

# --- 7. Ingress Configuration ---
ingress:
  enabled: true
  className: "" # GKE 기본 Ingress Controller 사용
  annotations:
    kubernetes.io/ingress.global-static-ip-name: "" # 필요시 정적 IP 이름 지정
    networking.gke.io/load-balancer-type: "External"
  allowHttp: false
  managedCertificate:
    enabled: true
    name: ""
    domains:
      - api.stockit.live # API 전용 서브도메인
      - www.stockit.live # www 도메인 (API 경로만)
      - stockit.live # 루트 도메인 (API 경로만)
  hosts:
    - host: api.stockit.live # API 전용 서브도메인
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              port:
                number: 8080
    - host: www.stockit.live # www 도메인 (API 경로만 백엔드로)
      paths:
        - path: /api
          pathType: Prefix
          backend:
            service:
              port:
                number: 8080
        - path: /actuator
          pathType: Prefix
          backend:
            service:
              port:
                number: 8080
        - path: /ws
          pathType: Prefix
          backend:
            service:
              port:
                number: 8080
        - path: /swagger-ui
          pathType: Prefix
          backend:
            service:
              port:
                number: 8080
    - host: stockit.live # 루트 도메인 (API 경로만 백엔드로)
      paths:
        - path: /api
          pathType: Prefix
          backend:
            service:
              port:
                number: 8080
        - path: /actuator
          pathType: Prefix
          backend:
            service:
              port:
                number: 8080
        - path: /ws
          pathType: Prefix
          backend:
            service:
              port:
                number: 8080
        - path: /swagger-ui
          pathType: Prefix
          backend:
            service:
              port:
                number: 8080
  tls: []

# --- 8. HTTPRoute Configuration ---
httpRoute:
  enabled: false
  name: stockit-httproute
  host: stockit.local
  serviceName: spring-backend-service
  servicePort: 8080

# --- 9. Autoscaling (HPA) Configuration ---
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# --- 10. Monitoring / PDB Configuration ---
serviceMonitor:
  enabled: false
pdb:
  enabled: false
